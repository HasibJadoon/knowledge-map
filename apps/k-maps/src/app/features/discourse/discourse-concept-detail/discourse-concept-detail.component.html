<div *ngIf="concept as c" class="card concept-detail-card">
  <div class="card-body">
    <a class="btn btn-sm btn-outline-secondary mb-3 back-button" routerLink="/discourse/wv_concepts">Back</a>

    <div class="mb-3 header-block">
      <h5 class="mb-1 concept-label-ar">{{ c.label_ar }}</h5>
      <div class="text-medium-emphasis">{{ c.label_en }}</div>
      <small class="text-medium-emphasis">Category: {{ c.category }}</small>
    </div>

    <div class="concept-tabs">
      <button
        class="tab-icon-btn"
        type="button"
        [class.active]="activeTab === 'definition'"
        (click)="setTab('definition')"
        aria-label="Definition"
      >
        <svg cIcon name="cilDescription"></svg>
      </button>
      <button
        class="tab-icon-btn"
        type="button"
        [class.active]="activeTab === 'evidence'"
        (click)="setTab('evidence')"
        aria-label="Qur'an Evidence"
      >
        <svg cIcon name="cilFile"></svg>
      </button>
      <button
        class="tab-icon-btn"
        type="button"
        [class.active]="activeTab === 'flow'"
        (click)="setTab('flow')"
        aria-label="Concept Flow"
      >
        <svg cIcon name="cilShareBoxed"></svg>
      </button>
      <button
        class="tab-icon-btn"
        type="button"
        [class.active]="activeTab === 'discourses'"
        (click)="setTab('discourses')"
        aria-label="Other Discourses"
      >
        <svg cIcon name="cilLayers"></svg>
      </button>
      <button
        class="tab-icon-btn"
        type="button"
        [class.active]="activeTab === 'relations'"
        (click)="setTab('relations')"
        aria-label="Qur'an Relations"
      >
        <svg cIcon name="cilShareAll"></svg>
      </button>
      <button
        class="tab-icon-btn"
        type="button"
        [class.active]="activeTab === 'crossrefs'"
        (click)="setTab('crossrefs')"
        aria-label="Cross References"
      >
        <svg cIcon name="cilExternalLink"></svg>
      </button>
    </div>

    <div class="section-block" *ngIf="activeTab === 'definition'">
      <h6 class="section-title">Definition</h6>
      <p class="mb-0">{{ c.definition }}</p>
    </div>

    <div class="section-block" *ngIf="activeTab === 'evidence'">
      <h6 class="section-title">Qur'an Evidence (Primary)</h6>
      <div class="list-group concept-list">
        <div class="list-group-item concept-item" *ngFor="let item of c.quranEvidence">
          <div class="fw-semibold">{{ item.ref }} — {{ item.snippet }}</div>
          <div class="text-medium-emphasis">{{ item.note }}</div>
        </div>
      </div>
    </div>

    <div class="section-block" *ngIf="activeTab === 'flow'">
      <h6 class="section-title">Qur'anic Concept Flow</h6>
      <div class="text-center flow-block">
        <div *ngFor="let node of c.flow; let last = last">
          <div class="fw-semibold">{{ node }}</div>
          <div *ngIf="!last" class="text-medium-emphasis">↓</div>
        </div>
      </div>
    </div>

    <div class="section-block" *ngIf="activeTab === 'discourses'">
      <h6 class="section-title">Other Discourses (Secondary)</h6>
      <div class="mb-3 other-block" *ngFor="let block of c.otherDiscourses">
        <div class="fw-semibold other-title">{{ block.name }}</div>
        <ul class="mb-0">
          <li *ngFor="let item of block.bullets">{{ item }}</li>
        </ul>
      </div>
    </div>

    <div class="section-block" *ngIf="activeTab === 'relations'">
      <h6 class="section-title">Qur'an Relation (Criterion)</h6>
      <div class="list-group concept-list">
        <button
          class="list-group-item list-group-item-action concept-item"
          type="button"
          *ngFor="let rel of c.relations"
          (click)="openRelation(rel.id)"
        >
          <div class="d-flex justify-content-between align-items-start gap-2">
            <div>
              <div class="fw-semibold">{{ rel.source }}</div>
              <div class="text-medium-emphasis">{{ rel.summary }}</div>
            </div>
            <span class="badge relation-badge" [class]="relationBadge(rel.status)">
              {{ relationLabel(rel.status) }}
            </span>
          </div>
        </button>
        <div class="list-group-item concept-item" *ngIf="c.relations.length === 0">
          No relations yet.
        </div>
      </div>
    </div>

    <div class="section-block" *ngIf="activeTab === 'crossrefs'">
      <h6 class="section-title">Cross References</h6>
      <ul class="mb-0">
        <li *ngFor="let ref of c.crossRefs">{{ ref }}</li>
      </ul>
    </div>
  </div>
</div>
