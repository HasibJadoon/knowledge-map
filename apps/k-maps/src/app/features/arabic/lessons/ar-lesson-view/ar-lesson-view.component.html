<div class="card mb-3">
  <div class="card-body">
    <div class="d-flex align-items-center">
      <h5 class="card-title mb-0" [ngClass]="isArabicText(title) ? 'arabic-inline' : ''">
        {{ title }}
      </h5>
      <div class="ms-auto d-flex gap-2">
        <button class="btn btn-outline-secondary btn-sm" type="button" (click)="back()">Back</button>
        <button class="btn btn-primary btn-sm" type="button" (click)="edit()">Edit</button>
      </div>
    </div>
    <div class="text-body-secondary mt-1 status-line">
      {{ lessonType }} •
      <span class="badge status-badge" [ngClass]="statusBadgeClass(status)">
        {{ status }}
      </span>
    </div>
    <div class="text-body-secondary small" *ngIf="source">
      Source:
      <a class="source-link" [href]="source" target="_blank" rel="noopener noreferrer">
        {{ source }}
      </a>
    </div>
  </div>
</div>

<div *ngIf="error" class="alert alert-danger py-2">{{ error }}</div>
<div *ngIf="loading" class="text-muted">Loading…</div>

<div *ngIf="!loading" class="card">
  <div class="card-body">
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <button
          class="nav-link"
          type="button"
          [class.active]="activeTab === 'details'"
          (click)="activeTab = 'details'"
        >
          Details
        </button>
      </li>
      <li class="nav-item">
        <button
          class="nav-link"
          type="button"
          [class.active]="activeTab === 'json'"
          (click)="activeTab = 'json'"
        >
          JSON
        </button>
      </li>
    </ul>

    <div *ngIf="activeTab === 'details'">
      <app-quran-lesson-details
        *ngIf="isQuranLesson"
        [text]="lessonJson.text"
        [comprehension]="lessonJson.comprehension"
      ></app-quran-lesson-details>
      <app-classic-lesson-details *ngIf="!isQuranLesson" [lessonJson]="lessonJson"></app-classic-lesson-details>
    </div>

    <div *ngIf="activeTab === 'json'">
      <pre class="json-preview">{{ jsonText }}</pre>
    </div>
  </div>
</div>
