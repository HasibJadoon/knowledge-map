<div class="mb-4">
  <h6 class="card-title section-heading">Arabic Text</h6>
  <hr class="section-divider" />
  <div class="section-card">
    <div class="arabic-text" *ngIf="text.arabic">{{ text.arabic }}</div>
    <hr *ngIf="text.arabic && text.translation" class="neon-divider" />
    <div class="text-muted" *ngIf="text.translation">{{ text.translation }}</div>
    <hr *ngIf="text.translation && text.reference" class="neon-divider" />
    <div class="small text-body-secondary" *ngIf="text.reference">{{ text.reference }}</div>
  </div>
</div>

<div class="mb-4">
  <h6 class="card-title section-heading">Vocabulary</h6>
  <hr class="section-divider" />
  <div *ngIf="!vocabulary.length" class="text-muted">No vocabulary.</div>
  <div class="table-responsive" *ngIf="vocabulary.length">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>Word</th>
          <th>Root</th>
          <th>Type</th>
          <th>Meaning</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let v of vocabulary">
          <td>{{ v.word }}</td>
          <td>{{ v.root }}</td>
          <td>{{ v.type }}</td>
          <td>{{ v.meaning }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div>
  <h6 class="card-title section-heading">Comprehension</h6>
  <hr class="section-divider" />
  <ng-container *ngIf="compBlocks.length; else noComp">
    <div class="mb-3" *ngFor="let block of compBlocks; let i = index">
      <div class="section-card">
        <div class="comp-block-title">{{ formatType(block?.type) }}</div>

        <div *ngIf="block?.type === 'memory_recall'">
          <div class="mb-2">
            <div class="memory-label">Verbs</div>
            <hr class="mini-neon-divider" />
            <div class="arabic-inline" *ngIf="block?.verbs?.length; else emptyVerbs">
              {{ formatList(block?.verbs) }}
            </div>
            <ng-template #emptyVerbs>
              <div class="text-muted">—</div>
            </ng-template>
          </div>
          <div class="mb-2">
            <div class="memory-label">Nouns</div>
            <hr class="mini-neon-divider" />
            <div class="arabic-inline" *ngIf="block?.nouns?.length; else emptyNouns">
              {{ formatList(block?.nouns) }}
            </div>
            <ng-template #emptyNouns>
              <div class="text-muted">—</div>
            </ng-template>
          </div>
          <div *ngIf="block?.questions?.length">
            <div class="memory-label">Questions</div>
            <hr class="mini-neon-divider" />
            <ul class="list-unstyled question-list">
              <ng-container *ngFor="let q of block.questions; let qi = index">
                <li *ngIf="shouldInsertBreak(block.questions, qi)" class="question-break">
                  <hr class="neon-divider" />
                </li>
                <li [ngClass]="questionClass(q)">
                  {{ formatQuestionDisplay(q) }}
                </li>
              </ng-container>
            </ul>
          </div>
        </div>

        <div *ngIf="block?.type === 'passage_questions'">
          <div class="memory-label">Questions</div>
          <hr class="mini-neon-divider" />
          <ul class="list-unstyled question-list" *ngIf="block?.questions?.length; else emptyQuestions">
            <ng-container *ngFor="let q of block.questions; let qi = index">
              <li *ngIf="shouldInsertBreak(block.questions, qi)" class="question-break">
                <hr class="neon-divider" />
              </li>
              <li [ngClass]="questionClass(q)">
                {{ formatQuestionDisplay(q) }}
              </li>
            </ng-container>
          </ul>
          <ng-template #emptyQuestions>
            <div class="text-muted">No questions.</div>
          </ng-template>
        </div>

        <div *ngIf="block?.type !== 'memory_recall' && block?.type !== 'passage_questions'">
          <pre class="json-preview">{{ block | json }}</pre>
        </div>
      </div>
      <hr *ngIf="i < compBlocks.length - 1" class="comp-divider" />
    </div>
  </ng-container>
  <ng-template #noComp>
    <div class="text-muted">No comprehension notes.</div>
  </ng-template>
</div>
